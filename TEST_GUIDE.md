# 星露谷物语聊天室测试指南

## 🚀 快速启动

### 1. 启动服务器
```bash
npm start
```

### 2. 访问应用
在浏览器中访问：`http://localhost:3000`

## 🧪 功能测试

### 基础功能测试

#### 1. 用户登录测试
- [ ] 输入用户名和房间名
- [ ] 点击"加入聊天室"按钮
- [ ] 验证是否成功进入聊天界面

#### 2. 房间管理测试
- [ ] 创建新房间（输入不存在的房间名）
- [ ] 加入已存在的房间
- [ ] 验证房间用户数量显示（0/10 -> 1/10）

#### 3. 消息发送测试
- [ ] 发送普通文本消息
- [ ] 发送长消息（测试200字符限制）
- [ ] 发送空消息（应该显示错误提示）
- [ ] 验证消息显示格式（用户名、时间戳、内容）

#### 4. 多用户测试
- [ ] 在多个浏览器窗口/标签页中打开聊天室
- [ ] 使用不同用户名加入同一房间
- [ ] 验证用户列表实时更新
- [ ] 测试消息广播功能

#### 5. 历史消息测试
- [ ] 在房间中发送几条消息
- [ ] 新用户加入房间
- [ ] 验证新用户可以看到历史消息
- [ ] 验证历史消息显示分隔线
- [ ] 测试历史消息限制（最多50条）

#### 6. 用户离开测试
- [ ] 点击"离开房间"按钮
- [ ] 关闭浏览器窗口
- [ ] 验证其他用户收到离开通知
- [ ] 验证用户列表实时更新

#### 7. 全局统计测试
- [ ] 访问主页，验证显示"在线: 0"
- [ ] 用户加入房间，验证在线人数增加
- [ ] 不同房间的用户，验证总人数统计
- [ ] 用户离开房间，验证在线人数减少
- [ ] 验证统计数据实时更新

#### 8. 房间通知测试
- [ ] 第一个用户加入房间
- [ ] 第二个用户加入同一房间
- [ ] 验证第一个用户看到加入通知弹窗
- [ ] 验证弹窗显示正确的用户名和"加入房间"
- [ ] 验证弹窗3秒后自动消失
- [ ] 用户离开房间，验证其他用户看到离开通知
- [ ] 点击弹窗测试立即关闭功能

#### 9. AI聊天室测试
- [ ] 选择"AI聊天室"选项
- [ ] 验证房间名称输入框被禁用
- [ ] 验证标签显示"AI聊天室（无人数限制）"
- [ ] 用户成功加入AI聊天室
- [ ] 验证用户数量显示"用户数: X (无限制)"
- [ ] 发送消息给AI，验证AI回复
- [ ] 验证AI消息有特殊样式（蓝色边框、机器人图标）
- [ ] 测试AI对话历史记录功能
- [ ] 验证多用户可以同时与AI对话

### 限制测试

#### 1. 房间容量限制
- [ ] 在同一房间中尝试加入超过10个用户
- [ ] 验证第11个用户无法加入，显示"房间已满"错误

#### 2. 用户名重复
- [ ] 在同一房间中使用相同用户名
- [ ] 验证显示"用户名已存在"错误

#### 3. 输入验证
- [ ] 测试用户名超过20个字符
- [ ] 测试房间名超过30个字符
- [ ] 测试消息超过200个字符
- [ ] 测试空用户名/房间名

## 📱 响应式测试

### 移动端测试
- [ ] 在手机浏览器中打开聊天室
- [ ] 验证界面适配是否正常
- [ ] 测试触屏操作是否流畅

### 不同屏幕尺寸测试
- [ ] 桌面端（1920x1080）
- [ ] 平板端（768x1024）
- [ ] 手机端（375x667）

## 🌐 网络测试

### 连接稳定性测试
- [ ] 断开网络连接
- [ ] 验证断线重连功能
- [ ] 测试网络恢复后的状态

### 并发测试
- [ ] 同时发送多条消息
- [ ] 多用户同时加入/离开房间
- [ ] 验证系统稳定性

## 🔍 性能测试

### 消息历史测试
- [ ] 发送大量消息
- [ ] 验证消息容器滚动性能
- [ ] 测试内存占用情况

### 用户数量测试
- [ ] 在房间中添加接近10个用户
- [ ] 验证用户列表更新性能
- [ ] 测试消息广播性能

## 🛠️ 调试信息

### 浏览器控制台
打开浏览器开发者工具，查看控制台日志：
- 连接状态信息
- 错误信息
- Socket.IO事件日志

### 服务器日志
查看终端输出：
- 用户连接/断开信息
- 房间创建/删除信息
- 消息广播日志

## 🎯 测试用例示例

### 用例1：新用户加入房间
1. 打开浏览器，访问 `http://localhost:3000`
2. 输入用户名："小明"
3. 输入房间名："农场讨论"
4. 点击"加入聊天室"
5. 验证：成功进入聊天界面，显示欢迎消息

### 用例2：多用户聊天
1. 在两个浏览器窗口中重复用例1（使用不同用户名）
2. 在第一个窗口发送消息："大家好！"
3. 验证：第二个窗口收到消息
4. 在第二个窗口回复："你好！"
5. 验证：第一个窗口收到回复

### 用例3：房间容量限制
1. 使用10个不同浏览器窗口/设备
2. 用不同用户名加入同一房间
3. 尝试第11个用户加入
4. 验证：显示"房间已满"错误

### 用例4：历史消息功能
1. 第一个用户（用户A）加入房间"测试房间"
2. 用户A发送消息："这是第一条消息"
3. 用户A发送消息："这是第二条消息"
4. 第二个用户（用户B）加入同一房间
5. 验证：用户B看到历史消息分隔线和之前的消息
6. 用户B发送消息："我看到了历史消息"
7. 验证：消息显示在"当前消息"部分

### 用例5：全局统计功能
1. 打开浏览器，访问主页
2. 验证：显示"在线: 0"
3. 用户A加入房间"房间1"
4. 在新窗口访问主页，验证：显示"在线: 1"
5. 用户B加入房间"房间2"（不同房间）
6. 在新窗口访问主页，验证：显示"在线: 2"
7. 用户A离开房间
8. 验证：显示"在线: 1"

### 用例6：房间通知功能
1. 用户A加入房间"测试房间"
2. 用户B加入同一房间"测试房间"
3. 验证：用户A右下角弹出"用户B加入房间"通知
4. 验证：通知有🎉图标和正确的用户名
5. 等待3秒，验证：通知自动消失
6. 用户C加入同一房间
7. 点击通知弹窗，验证：立即关闭
8. 用户C离开房间
9. 验证：其他用户看到"用户C退出房间"通知（👋图标）

### 用例7：AI聊天室功能
1. 打开聊天室主页
2. 选择"🤖 AI聊天室"选项
3. 验证：房间名称输入框被禁用，显示"AI聊天室（固定）"
4. 输入用户名"测试用户"，点击加入
5. 验证：成功进入AI聊天室
6. 验证：用户数量显示"用户数: 1 (无限制)"，颜色为橙色
7. 发送消息："你好，AI助手"
8. 验证：AI回复消息有特殊样式（蓝色边框、🤖图标）
9. 继续对话测试历史记录功能
10. 开启第二个浏览器窗口，另一个用户加入AI聊天室
11. 验证：两个用户都能与AI正常对话

## 🚨 常见问题

### 问题1：无法连接到服务器
**解决方案：**
- 检查服务器是否启动（`npm start`）
- 检查端口3000是否被其他程序占用
- 确认防火墙设置

### 问题2：消息发送失败
**解决方案：**
- 检查网络连接
- 刷新页面重新连接
- 查看浏览器控制台错误信息

### 问题3：用户列表不更新
**解决方案：**
- 检查WebSocket连接状态
- 尝试重新加入房间
- 查看服务器日志

### 问题4：AI聊天室无法正常工作
**解决方案：**
- 检查Python环境是否正确安装
- 确认`llama-cpp-python`库已安装
- 检查模型文件路径是否正确
- 查看服务器终端的Python错误信息
- 尝试直接运行`python ai_chat_handler.py`测试

### 问题5：AI回复速度很慢
**解决方案：**
- 检查模型文件大小和系统性能
- 考虑使用更小的模型文件
- 检查是否有其他程序占用GPU/CPU资源
- 可以调整`ai_chat_handler.py`中的`n_threads`参数

## 📊 测试报告模板

```
测试时间：[日期时间]
测试人员：[姓名]
测试环境：[浏览器版本/操作系统]

基础功能测试：
- 用户登录：✅/❌
- 消息发送：✅/❌
- 多用户聊天：✅/❌
- 用户离开：✅/❌
- 历史消息：✅/❌
- 全局统计：✅/❌
- 房间通知：✅/❌
- AI聊天室：✅/❌

限制测试：
- 房间容量：✅/❌
- 用户名重复：✅/❌
- 输入验证：✅/❌

性能测试：
- 响应速度：✅/❌
- 并发处理：✅/❌
- 内存占用：✅/❌

发现问题：
1. [描述问题]
2. [描述问题]

建议改进：
1. [改进建议]
2. [改进建议]
``` 